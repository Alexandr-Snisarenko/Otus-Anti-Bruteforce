# Anti-Bruteforce Service
Финальный проект по курсу Golang от компании OTUS.

## Общее описание
Сервис предназначен для борьбы с подбором паролей при авторизации в какой-либо системе.

Сервис вызывается перед авторизацией пользователя и может либо разрешить, либо заблокировать попытку.
Поддерживает rate-limiting по login / password / IP, а также white/black списки подсетей.

Предполагается, что сервис используется только для server-server, т.е. скрыт от конечного пользователя.

Поддерживает два режима работы (настраивается через config.yml):
 - local - все данные хранятся в памяти приложения. В данном режиме сервис не масштабируется.
 - external - для хранения данных используются внешние хранилища PostgreSQL и Redis. В данном режиме поддерживается работа нескольких экземпляров сервиса.

## Алгоритм работы
Сервис ограничивает частоту попыток авторизации для различных комбинаций параметров, например:
* не более N = 10 попыток в минуту для данного логина.
* не более M = 100 попыток в минуту для данного пароля (защита от обратного brute-force).
* не более K = 1000 попыток в минуту для данного IP (число большое, т.к. NAT).

## Архитектура
Архитектура построена в стиле ports & adapters.
Сервис состоит из:
- gRPC API
- слоя приложения (core-логика)
- хранилищ (PostgreSQL — списки, Redis — rate limit)
- CLI-клиента для администрирования (abfctl)

## API
Сервис предоставляет gRPC API.
Описание методов находится в proto-файлах:
```text
api/proto/anti_bruteforce/v1/*.proto
```

## Документация
Документация по проекту в каталоге docs/.

## Конфигурация
Конфигурирование сервиса выполняется через файл config.yml.
Путь к файлу конфигурации указывается в флаге --config при старте сервиса.
Поддерживается конфигурация через ENV переменные.

## Ограничения
- Поддерживается только IPv4
- Авторизация и ACL не реализованы (в соответствии с ТЗ)
- Сервис предназначен только для server-to-server взаимодействия

## CLI 
CLI клиент - abfctl - предназначен для администрирования сервиса.
Примеры:
```bash
abfctl --addr 127.0.0.1:50051 check --login user --pass secret --ip 192.168.1.1
abfctl --addr 127.0.0.1:50051 blacklist add --cidr 192.168.2.0/24
abfctl --addr 127.0.0.1:50051 whitelist remove --cidr 192.168.1.0/24
abfctl --addr 127.0.0.1:50051 reset --login user  --ip 192.168.1.1
```

Примечание: Команда reset (как и метод gRPC сервиса) поддерживает только два аргумента login и ip.
Это не ошибка, а нюанс технического задания.

## Запуск
Локальный запуск:
```bash
make run
```
Запуск контейнера:
```bash
make run-img
```

Запуск с окружением (Docker Compose):
```bash
make run-compose
```

## Тестирование
Unit тесты:
```bash
make test
```
Race тесты:
```bash
make test-race
```
Интеграционные тест:
```bash
make test-integration
```
